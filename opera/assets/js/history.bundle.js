import{r as a,j as e,c as x,I as C,b as R,u as v,B as w,L as T,n as L,f as W,m as q,R as H,o as U,p as O,q as D}from"./Loader-DqDKbA-0.chunk.js";import{M as I,K as f,F as P}from"./background.bundle.js";import{H as M}from"./Header-Dh2SEPye.chunk.js";import{Q as B,C as F}from"./index-BtFWZ24X.chunk.js";var j=(t=>(t.HYDRATE_SHORTENED_LINKS="hydrate-shortened-links",t.SET_CURRENT_SELECTED="toggle-qrcode-modal",t))(j||{});const V={items:[],total:0,selected:null},g=a.createContext(void 0),N=a.createContext(void 0),z=(t,n)=>{switch(n.type){case"hydrate-shortened-links":return{...t,...n.payload};case"toggle-qrcode-modal":{const l=t.items.filter(i=>i.id===n.payload)[0]||null;return{...t,selected:l}}default:return t}};function Q(){const t=a.useContext(g);if(t===void 0)throw new Error("useShortenedLinksContextState must be used within a ShortenedLinksProvider");return t}function A(){const t=a.useContext(N);if(t===void 0)throw new Error("useShortenedLinksContextDispatch must be used within a ShortenedLinksProvider");return t}function b(){return[Q(),A()]}function K({children:t}){const[n,l]=a.useReducer(z,V);return e.jsx(e.Fragment,{children:e.jsx(g.Provider,{value:n,children:e.jsx(N.Provider,{value:l,children:t})})})}const Y="_modalOverlay_qz85i_1",G="_modalContent_qz85i_14",$="_qrCodeWrapper_qz85i_21",X="_buttonWrapper_qz85i_26",J="_closeButton_qz85i_32",u={modalOverlay:Y,modalContent:G,qrCodeWrapper:$,buttonWrapper:X,closeButton:J};function Z({link:t,setModalView:n}){return e.jsx(e.Fragment,{children:e.jsx("div",{className:u.modalOverlay,children:e.jsxs("div",{className:u.modalContent,children:[e.jsx("div",{className:u.qrCodeWrapper,children:e.jsx(B,{size:196,value:t})}),e.jsx("div",{className:u.buttonWrapper,children:e.jsx("button",{onClick:()=>n(!1),className:u.closeButton,type:"button",children:"Close"})})]})})})}const ee="_tableContainer_1nd9l_1",te="_tableWrapper_1nd9l_12",se="_tableHeader_1nd9l_21",oe="_tableTitle_1nd9l_27",re="_table_1nd9l_1",ne="_thead_1nd9l_43",ae="_theadRow_1nd9l_52",le="_th_1nd9l_43",ie="_thOriginal_1nd9l_70",de="_thShort_1nd9l_74",ce="_tbody_1nd9l_78",he="_tr_1nd9l_84",_e="_td_1nd9l_92",pe="_tdOriginal_1nd9l_99",ue="_tdShort_1nd9l_115",me="_link_1nd9l_131",xe="_copiedNotification_1nd9l_144",ye="_shortUrlWrapper_1nd9l_152",je="_actionsWrapper_1nd9l_157",Se="_actionIcon_1nd9l_163",Ce="_emptyRow_1nd9l_189",s={tableContainer:ee,tableWrapper:te,tableHeader:se,tableTitle:oe,table:re,thead:ne,theadRow:ae,th:le,thOriginal:ie,thShort:de,tbody:ce,tr:he,td:_e,tdOriginal:pe,tdShort:ue,link:me,copiedNotification:xe,shortUrlWrapper:ye,actionsWrapper:je,actionIcon:Se,emptyRow:Ce};function fe(){const[t,n]=b(),[l,i]=a.useState(!1),[d,c]=a.useState(!1);a.useEffect(()=>{let o=null;return o=setTimeout(()=>{c(!1)},1300),()=>{o&&clearTimeout(o)}},[d]);function S(o){n({type:j.SET_CURRENT_SELECTED,payload:o}),c(!0)}function r(o){n({type:j.SET_CURRENT_SELECTED,payload:o}),i(!0)}return e.jsx(e.Fragment,{children:e.jsx("div",{className:s.tableContainer,children:e.jsxs("div",{className:s.tableWrapper,children:[e.jsx("div",{className:s.tableHeader,children:e.jsxs("h2",{className:s.tableTitle,children:["Recent shortened links. (last ",I," results)"]})}),e.jsxs("table",{className:s.table,children:[e.jsx("thead",{className:s.thead,children:e.jsxs("tr",{className:s.theadRow,children:[e.jsx("th",{className:x(s.th,s.thOriginal),children:"Original URL"}),e.jsx("th",{className:x(s.th,s.thShort),children:"Short URL"})]})}),e.jsx("tbody",{className:s.tbody,children:t.total!==0?t.items.map(o=>{var _,h,p;return e.jsxs("tr",{className:s.tr,children:[e.jsx("td",{className:x(s.td,s.tdOriginal),children:e.jsx("a",{className:s.link,href:o.target,target:"_blank",rel:"noopener noreferrer nofollow",children:o.target})}),e.jsxs("td",{className:x(s.td,s.tdShort),children:[d&&((_=t.selected)==null?void 0:_.id)===o.id&&e.jsx("div",{className:s.copiedNotification,children:"Copied to clipboard!"}),e.jsx("div",{className:s.shortUrlWrapper,children:e.jsx("a",{className:s.link,href:o.link,target:"_blank",rel:"noopener noreferrer nofollow",children:o.link})})]}),e.jsxs("td",{className:s.td,children:[e.jsxs("div",{className:s.actionsWrapper,children:[d&&((h=t.selected)==null?void 0:h.id)===o.id?e.jsx(C,{name:"tick",className:s.actionIcon}):e.jsx(F,{text:o.link,onCopy:()=>S(o.id),children:e.jsx(C,{name:"copy",className:s.actionIcon})}),e.jsx(C,{onClick:()=>r(o.id),className:s.actionIcon,name:"qrcode"})]}),l&&((p=t.selected)==null?void 0:p.id)===o.id&&e.jsx(Z,{link:o.link,setModalView:i})]})]},o.id)}):e.jsx("tr",{children:e.jsx("td",{className:s.emptyRow,children:"No URLs History"})})})]})]})})})}const ge="_historyPage_wgkjd_1",Ne="_historyContent_wgkjd_6",be="_errorMessage_wgkjd_11",ke="_loaderContainer_wgkjd_17",y={historyPage:ge,historyContent:Ne,errorMessage:be,loaderContainer:ke};function Ee(){const[,t]=b(),[,n]=R(),[l,i]=v(),[d,c]=a.useState({error:null,message:""});return a.useEffect(()=>{async function S(){var p;const{settings:r={}}=await L(),o=(r==null?void 0:r.advanced)||!1,_=o&&(r==null?void 0:r.host)&&W(r.host)&&{hostDomain:r.host.replace("http://","").replace("https://","").replace("www.","").split(/[/?#]/)[0]||"",hostUrl:r.host.endsWith("/")?r.host.slice(0,-1):r.host}||f,h={apikey:((p=r==null?void 0:r.apikey)==null?void 0:p.trim())||"",history:(r==null?void 0:r.history)||!1,advanced:_.hostUrl.trim()!==f.hostUrl&&o,host:_};if(h.history){const E={apikey:h.apikey,hostUrl:h.host.hostUrl},m=await q.send(P,E);m.error?c({error:!0,message:m.message}):(c({error:!1,message:"Fetch successful"}),t({type:j.HYDRATE_SHORTENED_LINKS,payload:{items:m.data.data,total:m.data.total}}))}else c({error:!0,message:"History page disabled. Please enable it from settings."});i({type:H.SET_LOADING,payload:!1})}S()},[n,i,t]),e.jsx(w,{children:e.jsx("div",{id:"history",className:y.historyPage,children:e.jsxs("div",{className:y.historyContent,children:[e.jsx(M,{}),l.loading?e.jsx("div",{className:y.loaderContainer,children:e.jsx(T,{})}):d.error?e.jsx("h2",{className:y.errorMessage,children:d.message}):e.jsx(fe,{})]})})})}const k=document.getElementById("history-root");if(!k)throw new Error("Could not find history-root container");const Re=U.createRoot(k);Re.render(e.jsx(a.StrictMode,{children:e.jsx(O,{children:e.jsx(D,{children:e.jsx(K,{children:e.jsx(Ee,{})})})})}));
